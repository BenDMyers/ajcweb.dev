---
import PageLayout from "@/layouts/Base"
import BlogPostPreview from "@/components/BlogPostPreview"
import Pagination from "@/components/Paginator"
import { sortMDByDate } from "src/util"
import type { Post, Page, MDXInstance } from "@/util"

export async function getStaticPaths({ paginate }) {
	const allPosts = await Astro.glob<Post>("../*.mdx")
	const allPostsByDate = sortMDByDate(allPosts)

	return paginate(
		allPostsByDate,
		{ pageSize: 20 }
	)
}

export interface Props {
	page: Page<MDXInstance<Post>>
}

const { page } = Astro.props as Props

const meta = {
	title: "Posts",
	description: "Posts of the Blog",
}

const paginationProps = {
	...(page.url.prev && {
		prevUrl: {
			url: page.url.prev, text: `← Previous Posts`,
		},
	}),
	...(page.url.next && {
		nextUrl: {
			url: page.url.next, text: `Next Posts →`,
		},
	}),
}
---

<PageLayout meta={meta}>
	<h1 class="mb-6 title">Posts</h1>
	<div>
		<section aria-label="Blog post list">
			<ul class="space-y-24">
				{
					page.data.map((p) => (
						<li class="flex flex-wrap items-center gap-x-2 [&_q]:w-full">
							<BlogPostPreview post={p} as="h2" />
						</li>
					))
				}
			</ul>
			<Pagination {...paginationProps} />
		</section>
	</div>
</PageLayout>